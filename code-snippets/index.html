---
layout: default
custom_js_top:
    - elasticlunr.min.js
---

<div id="home">
  <h1>Code Snippets</h1>
  <label for="search-box">Search: </label><input id="search-box" type="search" placeholder="search text here" />
  <section>
      <ul class="posts">
        {% assign sorted = site.code-snippets | sort: 'title' %}
        {% for post in sorted %}
          <li id="{{post.id | slugify }}"><a href="{{ post.url }}">{{ post.title }}{% if post.language %} - {{ post.language }}{% endif %}</a></li>
        {% endfor %}
      </ul>
  </section>
</div>

<script type="text/javascript">
var index = elasticlunr(function () {
    this.addField('title');
    this.addField('description');
    this.addField('language');
    this.addField('tags');
    this.setRef('id');
});

function onInput(e) {
  var results = index.search(e.target.value, {
    expand: true
  });
  var idhash = {};
  for(var i = 0; i < results.length; i++) {
    idhash[results[i]['ref']] = 1;
  }


  var lis = document.querySelectorAll('ul.posts li');
    for (var i = 0; i < lis.length; i++) {
      var id = lis[i].id;
      if(results.length === 0 || idhash[id] === 1) {
        lis[i].style.display = 'list-item';
      }
      else {
        lis[i].style.display = 'none';
      }
    }
}

fetch('post-data.json')
  .then(response => response.json())
  .then(data => {
    var j = data['data'];
    for(var i = 0; i < j.length; i++) {
      var doc = j[i];
      index.addDoc(doc);
    }

    var searchBox = document.getElementById('search-box');
    searchBox.addEventListener('input', onInput);
    searchBox.addEventListener('propertychange', onInput);

  });
</script>